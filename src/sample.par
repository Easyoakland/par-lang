define concat = [left][right] left begin {
  empty?     => right
  item[x] xs => .item(x) xs loop
}

define flatten = [tree] tree begin {
  leaf x      => .item(x).empty!
  node[l][r]? => concat(l loop)(r loop)
}

define listrgb =
  .item(.red!)
  .item(.green!)
  .item(.blue!)
  .empty!

define rgb = [value] value {
  red?   => .red!
  green? => .green!
  blue?  => .blue!
}

define zip = [list][seq] list begin {
  empty? => do {
    seq.close?
  } in .empty!

  item[x] xs => do {
    seq.next[y]
  } in .item((x)(y)!) xs loop
}

define zip2 = [seq1][seq2] begin {
  close => do {
    seq1.close?
    seq2.close?
  } in !

  next => do {
    seq1.next[x]
    seq2.next[y]
  } in ((x)(y)!) loop
}

define play = zip(listrgb)
